<div class='session-header'>
  <span class='title'>
    {{#if editable}}
      {{#editable-field
        value=title
        save=(action 'changeTitle')
        close=(action 'revertTitleChanges')
      as |isSaving save close|
      }}
        {{one-way-input
          value=title
          update=(action (mut title))
          onenter=save
          onescape=close
          disabled=isSaving
          focusOut=(action 'addErrorDisplayFor' 'title')
        }}
        {{#if (and (v-get this 'title' 'isInvalid') (is-in showErrorsFor 'title'))}}
          <span class="validation-error-message">{{v-get this 'title' 'message'}}</span>
        {{/if}}
      {{/editable-field}}
    {{else}}
      <h2>{{session.title}}</h2>
    {{/if}}
  </span>
  <span class ='session-publication'>
    {{#if editable}}
      {{#action-menu title=menuTitle icon=menuIcon classNameBindings='publicationStatus :publication-menu :session-publication-menu :right-edge'}}
        {{#if showAsIs}}
          <li class='danger' {{action 'publish'}}>{{t 'general.publishAsIs'}}</li>
        {{/if}}
        {{#if showPublish}}
          <li class='good' {{action 'publish'}}>{{t 'general.publishSession'}}</li>
        {{/if}}
        {{#if showReview}}
          {{#link-to 'session.publicationCheck' course session}}
            <li class='good' >{{t 'general.reviewMissingItems' count=session.allPublicationIssuesLength}}</li>
          {{/link-to}}
        {{/if}}
        {{#if showTbd}}
          <li class='good' {{action 'publishAsTbd'}}>{{t 'general.markAsScheduled'}}</li>
        {{/if}}
        {{#if showUnPublish}}
          <li class='danger' {{action 'unpublish'}}>{{t 'general.unPublishSession'}}</li>
        {{/if}}
      {{/action-menu}}
    {{else}}
      {{publication-status item=session}}
    {{/if}}
  </span>
</div>

<section class='session-overview'>
  <div class='title'>
    {{t 'general.overview'}}
  </div>
  <div class='session-overview-actions'>
    {{#if (and (is-fulfilled showCopy) (await showCopy))}}
      {{#link-to 'session.copy' session class='copy'}}
        {{fa-icon 'copy' title=(t 'general.copySession') fixedWidth=true}}
      {{/link-to}}
    {{/if}}
  </div>
  <div class='session-overview-content'>
    <div class='session-overview-options'>

      <div class="sessiontype">
        <label>{{t 'general.sessionType'}}:</label>
        <span>
          {{#if editable}}
            {{inplace-select
              value=session.sessionType.id
              options=sortedSessionTypes
              save='changeSessionType'
            }}
          {{else}}
            {{session.sessionType.title}}&nbsp;
          {{/if}}
        </span>
      </div>
      <div class="sessionsupplemental switch-block">
        <label>{{t 'general.supplementalCurriculum'}}:</label>
        <span>
          {{#if editable}}
            {{toggle-yesno yes=session.supplemental toggle=(action 'changeSupplemental')}}
          {{else}}
            {{#if session.supplemental}}
              <span class='add'>{{t 'general.yes'}}</span>
            {{else}}
              <span class='remove'>{{t 'general.no'}}</span>
            {{/if}}
          {{/if}}
        </span>
      </div>
      <div class="sessionspecialattire switch-block">
        <label>{{t 'general.specialAttireRequired'}}:</label>
        <span>
          {{#if editable}}
            {{toggle-yesno yes=session.attireRequired toggle=(action 'changeSpecialAttire')}}
          {{else}}
            {{#if session.attireRequired}}
              <span class='add'>{{t 'general.yes'}}</span>
            {{else}}
              <span class='remove'>{{t 'general.no'}}</span>
            {{/if}}
          {{/if}}
        </span>
      </div>
      <div class="sessionspecialequipment switch-block">
        <label>{{t 'general.specialEquipmentRequired'}}:</label>
        <span>
          {{#if editable}}
            {{toggle-yesno yes=session.equipmentRequired toggle=(action 'changeSpecialEquipment')}}
          {{else}}
            {{#if session.equipmentRequired}}
              <span class='add'>{{t 'general.yes'}}</span>
            {{else}}
              <span class='remove'>{{t 'general.no'}}</span>
            {{/if}}
          {{/if}}
        </span>
      </div>
      <hr>
      <div class="independentlearningcontrol switch-block">
        <label>{{t 'general.independentLearning'}}:</label>
        <span>
          {{#if editable}}
            {{toggle-yesno yes=session.isIndependentLearning toggle=(action 'saveIndependentLearning')}}
          {{else}}
            {{#if session.isIndependentLearning}}
              <span class='add'>{{t 'general.yes'}}</span>
            {{else}}
              <span class='remove'>{{t 'general.no'}}</span>
            {{/if}}
          {{/if}}
        </span>
      </div>
      {{#if session.isIndependentLearning}}
        <div class="sessionilmhours block">
          <label>{{t 'general.hours'}}:</label>
          <span>
            {{#if editable}}
              {{#editable-field
                value=hours
                save=(action 'changeIlmHours')
                close=(action 'revertIlmHoursChanges')
                as |isSaving save close|
              }}
                {{one-way-input
                  value=hours
                  update=(action (mut hours))
                  onenter=save
                  onescape=close
                  disabled=isSaving
                  focusOut=(action 'addErrorDisplayFor' 'hours')
                  keyDown=(action 'addErrorDisplayFor' 'hours')
                }}
                {{#if (and (v-get this 'hours' 'isInvalid') (is-in showErrorsFor 'hours'))}}
                  <span class="validation-error-message">{{v-get this 'hours' 'message'}}</span>
                {{/if}}
              {{/editable-field}}
            {{else}}
              {{session.ilmSession.hours}}&nbsp;
            {{/if}}
          </span>
        </div>
        <div class="sessionilmduedate block">
          <label>{{t 'general.dueBy'}}:</label>
          <span>
            {{#if (is-fulfilled session.ilmSession)}}
              {{#if editable}}
                {{#editable-field
                  value=(moment-format session.ilmSession.dueDate 'MM/DD/YY')
                  save=(action 'changeIlmDueDate')
                  close=(action 'revertIlmDueDateChanges')
                }}
                  {{pikaday-input
                    value=dueDate
                    format='MM/DD/YY'
                    onSelection=(action (mut dueDate))
                    focusOut=(action 'addErrorDisplayFor' 'dueDate')
                  }}
                  {{#if (and (v-get this 'dueDate' 'isInvalid') (is-in showErrorsFor 'dueDate'))}}
                    <span class="validation-error-message">{{v-get this 'dueDate' 'message'}}</span>
                  {{/if}}
                {{/editable-field}}
              {{else}}
                {{moment-format session.ilmSession.dueDate 'MM/DD/YY'}}
              {{/if}}
            {{/if}}
          </span>
        </div>
      {{/if}}
    </div>

    <div class="sessiondescription">
      <label>{{t 'general.description'}}:</label>
      <span class='list-reset'>
        {{#if editable}}
          {{#editable-field
            value=description
            save=(action 'saveDescription')
            close=(action 'revertDescriptionChanges')
            renderHtml=true
            isSaveDisabled=(and (v-get this 'description' 'isInvalid') (is-in showErrorsFor 'description'))
            clickPrompt=(t 'general.clickToEdit')
          }}
            {{froala-editor
              params=editorParams
              value=description
              contentChanged=(action "changeDescription")
            }}
            {{#if (and (v-get this 'description' 'isInvalid') (is-in showErrorsFor 'description'))}}
              <span class="validation-error-message">{{v-get this 'description' 'message'}}</span>
            {{/if}}
          {{/editable-field}}
        {{else}}
          {{description}}
        {{/if}}
      </span>
    </div>
    {{#unless session.isIndependentLearning}}
      <br>
      <div class="sessionassociatedgroups">
        <label>{{t 'general.associatedGroups'}}:</label>
        <span>
          {{#if session.associatedOfferingLearnerGroups.isFulfilled}}
            <span>
              {{#each session.associatedOfferingLearnerGroups as |group|}}
                {{group.title}},
              {{else}}
                {{t 'general.none'}}
              {{/each}}
            </span>
          {{else}}
            {{loading-part}}
          {{/if}}
        </span>
      </div>
    {{/unless}}
  </div>
</section>
