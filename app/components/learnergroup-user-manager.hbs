<div class="learnergroup-user-manager" ...attributes>
  <div class="title">
    {{#unless @isEditing}}
      {{t "general.members"}}
      ({{@users.length}})
    {{/unless}}
  </div>
  {{#if @users.length}}
    <div class="actions">
      <Input
        @value={{this.filter}}
        placeholder={{t "general.filterByNameOrEmail"}}
      />
    </div>
    <div class="learnergroup-user-manager-content">
      <div class="list">
        <table>
          <thead>
            <tr>
              <th class="text-left" colspan="1">
                {{#if @isEditing}}
                  <Input
                    @type="checkbox"
                    @checked={{eq this.selectedUsers.length this.filteredUsers.length}}
                    @indeterminate={{and
                      (gt this.selectedUsers.length 0)
                      (lt this.selectedUsers.length this.filteredUsers.length)
                    }}
                    {{on "click" (fn this.toggleUserSelectionAllOrNone)}}
                  />
                {{/if}}
              </th>
              <SortableTh
                @colspan={{2}}
                @click={{fn this.setSortBy "firstName"}}
                @sortedBy={{or
                  (eq sortBy "firstName")
                  (eq sortBy "firstName:desc")
                }}
                @sortedAscending={{sortedAscending}}
              >
                {{t "general.firstName"}}
              </SortableTh>
              <SortableTh
                @colspan={{2}}
                @click={{fn this.setSortBy "lastName"}}
                @sortedBy={{or (eq sortBy "lastName") (eq sortBy "lastName:desc")}}
                @sortedAscending={{sortedAscending}}
              >
                {{t "general.lastName"}}
              </SortableTh>
              <th class="text-left" colspan="2">
                {{t "general.campusId"}}
              </th>
              <th class="text-left hide-from-small-screen" colspan="5">
                {{t "general.email"}}
              </th>
              {{#if @isEditing}}
                <SortableTh
                  @colspan={{2}}
                  @click={{fn this.setSortBy "lowestGroupInTreeTitle"}}
                  @sortedBy={{or
                    (eq sortBy "lowestGroupInTreeTitle")
                    (eq sortBy "lowestGroupInTreeTitle:desc")
                  }}
                  @sortedAscending={{sortedAscending}}
                >
                  {{t "general.groupName"}}
                </SortableTh>
                <th class="text-left" colspan="1">
                  {{t "general.actions"}}
                </th>
              {{/if}}
            </tr>
          </thead>
        </table>
        {{#if @isEditing}}
          <div class="title" data-test-group-members>
            {{t "general.groupMembers"}}
            ({{this.usersInCurrentGroup.length}})
          </div>
        {{/if}}
        <table>
          <tbody>
            {{#each (sort-by @sortBy this.usersInCurrentGroup) as |user|}}
              <tr class={{unless user.enabled "disabled-user-account" ""}}>
                <td class="text-left" colspan="1">
                  {{#if (or user.enabled this.currentUser.isRoot)}}
                    {{#if @isEditing}}
                      <input
                        type="checkbox"
                        checked={{contains user.content this.selectedUsers}}
                        onclick={{fn this.toggleUserSelection user.content}}
                      >
                    {{/if}}
                  {{/if}}
                  {{#if (not user.enabled)}}
                    <FaIcon
                      @icon="user-times"
                      @title={{t "general.disabled"}}
                      class="error"
                    />
                  {{/if}}
                </td>
                <td class="text-left" colspan="2">
                  {{user.firstName}}
                </td>
                <td class="text-left" colspan="2">
                  {{user.lastName}}
                </td>
                <td class="text-left" colspan="2">
                  {{user.campusId}}
                </td>
                <td class="text-left hide-from-small-screen" colspan="5">
                  {{user.email}}
                </td>
                {{#if @isEditing}}
                  <td class="text-left" colspan="2">
                    <LinkTo
                      @route="learnerGroup"
                      @model={{user.lowestGroupInTree}}
                      @query={{hash isEditing=@isEditing sortUsersBy=@sortBy}}
                    >
                      {{user.lowestGroupInTree.title}}
                    </LinkTo>
                  </td>
                  <td>
                    {{#if (contains user.content this.usersBeingMoved)}}
                      <LoadingSpinner />
                    {{else if user.enabled}}
                      {{#if (eq this.selectedUsers.length 0)}}
                        <FaIcon
                          @icon="minus"
                          class="no clickable"
                          @title={{t
                            "general.removeLearnerToCohort"
                            cohort=cohortTitle
                            count=1
                          }}
                          @click={{perform this.removeSingleUser user.content}}
                        />
                      {{/if}}
                    {{/if}}
                  </td>
                {{/if}}
              </tr>
            {{/each}}
          </tbody>
        </table>
        {{#if @isEditing}}
          <div class="title" data-test-all-other-members>
            {{t "general.allOtherMembers" topLevelGroupTitle=@topLevelGroupTitle}}
            ({{this.usersNotInCurrentGroup.length}})
          </div>
          <table>
            <tbody>
              {{#each (sort-by @sortBy this.usersNotInCurrentGroup) as |user|}}
                <tr class={{unless user.enabled "disabled-user-account" ""}}>
                  <td class="text-left" colspan="1">
                    {{#if (or user.enabled this.currentUser.isRoot)}}
                      {{#if @isEditing}}
                        <input
                          type="checkbox"
                          checked={{contains user.content this.selectedUsers}}
                          {{on "click" (fn this.toggleUserSelection user.content)}}
                        >
                      {{/if}}
                    {{/if}}
                    {{#if (not user.enabled)}}
                      <FaIcon
                        @icon="user-times"
                        @title={{t "general.disabled"}}
                        class="error"
                      />
                    {{/if}}
                  </td>
                  <td class="text-left" colspan="2">
                    {{user.firstName}}
                  </td>
                  <td class="text-left" colspan="2">
                    {{user.lastName}}
                  </td>
                  <td class="text-left" colspan="2">
                    {{user.campusId}}
                  </td>
                  <td class="text-left hide-from-small-screen" colspan="5">
                    {{user.email}}
                  </td>
                  {{#if @isEditing}}
                    <td class="text-left" colspan="2">
                      <LinkTo
                        @route="learnerGroup"
                        @model={{user.lowestGroupInTree}}
                        @query={{hash isEditing=@isEditing sortUsersBy=@sortBy}}
                      >
                        {{user.lowestGroupInTree.title}}
                      </LinkTo>
                    </td>
                    <td>
                      {{#if (contains user.content this.usersBeingMoved)}}
                        <LoadingSpinner />
                      {{else if user.enabled}}
                        {{#if (eq this.selectedUsers.length 0)}}
                          <FaIcon
                            @icon="plus"
                            class="yes clickable"
                            @title={{t
                              "general.moveToGroup"
                              groupTitle=learnerGroupTitle
                              count=1
                            }}
                            @click={{perform this.addSingleUser user.content}}
                          />
                        {{/if}}
                      {{/if}}
                    </td>
                  {{/if}}
                </tr>
              {{/each}}
            </tbody>
          </table>
        {{/if}}
      </div>
    </div>
    {{#if (gt this.selectedUsers.length 0) class="vertical"}}
      <p class="fullwidth">
        <button type="button" class="done text" {{action (perform this.addSelectedUsers)}}>
          {{t
            "general.moveToGroup"
            groupTitle=@learnerGroupTitle
            count=this.selectedUsers.length
          }}
        </button>
        <button type="button" class="cancel text" {{action (perform this.removeSelectedUsers)}}>
          {{t
            "general.removeLearnerToCohort"
            cohort=@cohortTitle
            count=this.selectedUsers.length
          }}
        </button>
      </p>
    {{/if}}
  {{/if}}
</div>
