<Reports::SubjectHeader
  @report={{@report}}
  @school={{@school}}
  @subject={{@subject}}
  @prepositionalObject={{@prepositionalObject}}
  @prepositionalObjectTableRowId={{@prepositionalObjectTableRowId}}
  @year={{@year}}
  @changeYear={{@changeYear}}
  @showYearFilter={{not-eq @prepositionalObject "academic year"}}
  @description={{@description}}
  @fetchDownloadData={{this.fetchDownloadData}}
  @readyToDownload={{this.data.isResolved}}
  @resultsLength={{this.resultsLength}}
/>
<div data-test-reports-subject-course>
  {{#if this.data.isResolved}}
    <ul class="report-results{{if this.dataIsBeingLimited ' limited'}}" data-test-results>
      {{#each this.limitedCourses as |course|}}
        <li>
          {{#if this.showYear}}
            <span data-test-year>
              {{course.year}}
            </span>
          {{/if}}
          <span data-test-title>
            {{#if this.canViewCourse}}
              <LinkTo @route="course" @model={{course.id}}>
                {{course.title}}
                {{#if course.externalId}}
                  ({{course.externalId}})
                {{/if}}
              </LinkTo>
            {{else}}
              {{course.title}}
              {{#if course.externalId}}
                ({{course.externalId}})
              {{/if}}
            {{/if}}
          </span>
        </li>
      {{else}}
        <li>{{t "general.none"}}</li>
      {{/each}}
    </ul>
    {{#if this.dataIsBeingLimited}}
      {{#if this.showDetails}}
        <div class="detail-collapsed-control">
          <button type="button" data-test-expand-course-details {{on "click" this.collapse}}>
            {{t "general.collapseResults"}}
            <FaIcon @icon="square-minus" class="expand-collapse-icon" />
          </button>
        </div>
      {{else}}
        <div class="detail-collapsed-control">
          <button
            type="button"
            data-test-expand-course-details
            {{on "click" (fn this.setShowDetails true)}}
          >
            {{t "general.expandResults"}}
            <FaIcon @icon="square-plus" class="expand-collapse-icon" />
          </button>
        </div>
      {{/if}}
    {{/if}}
  {{else}}
    <LoadingSpinner />
  {{/if}}
</div>